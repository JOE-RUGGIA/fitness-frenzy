<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Fitness Frenzy â€“ V1.5 (Global BuyQty + Unlock Bounce)</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<style>
  :root{
    --bg:#0a1320; --card:#0f1b2b; --ink:#e9eef3; --muted:#a7b7cc; --border:#213149;
    --accent:#cc6b2c;          /* burnt orange */
    --accent-hi:#ffb357;       /* brighter orange */
    --rep:#22c55e;             /* green rep bar */
    --space:clamp(10px,2.2vw,18px); --r:14px;
    --fs-1:clamp(16px,2.4vw,18px); --fs-2:clamp(18px,3.2vw,22px); --fs-3:clamp(22px,5vw,28px);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);
       padding:env(safe-area-inset-top)0 env(safe-area-inset-bottom)0;}

  /* Sticky Top Bar */
  .topbar{position:sticky;top:0;z-index:10;background:rgba(10,19,32,.92);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
  .topwrap{max-width:980px;margin:0 auto;padding:8px var(--space);display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .title{display:flex;align-items:center;gap:10px}
  .title .icon{font-size:clamp(22px,5vw,28px)}
  h1{margin:0;font-size:var(--fs-3)}

  /* HP pill (big & fun) */
  .hpPill{
    display:flex; align-items:center; gap:10px;
    padding:8px 14px; border-radius:999px; background:linear-gradient(135deg,#132647,#1d3a61);
    border:1px solid #2a4a78; box-shadow:0 6px 18px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.04);
  }
  .hpPill .label{font-weight:900; letter-spacing:.3px; color:#ffd6a8}
  .hpPill .val{font-variant-numeric:tabular-nums; font-weight:900; font-size:clamp(20px,4.5vw,28px); color:#fff}

  .spacer{flex:1 1 auto}

  /* Global qty toggle */
  .seg{display:inline-flex;border:1px solid #2b3d5a;border-radius:10px;overflow:hidden}
  .segBtn{background:#13233b;color:#cfe0ff;border:0;padding:8px 12px;font-weight:800;cursor:pointer}
  .segBtn.active{background:var(--accent);color:#fff}
  .segBtn:active{transform:translateY(1px)}

  .btn{position:relative;overflow:hidden;padding:10px 14px;border:none;border-radius:12px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;
       transition:transform .04s ease,box-shadow .2s ease,filter .2s ease}
  .btn.secondary{background:#1a2a40;color:#d7e3f5}
  .btn:active{transform:translateY(1px)}
  .btn[disabled]{background:#2a3a51;color:#9ab;cursor:not-allowed}
  /* Ready shine (orange) */
  .btn.ready{box-shadow:0 0 0 1px rgba(255,255,255,.06) inset,0 8px 20px rgba(204,107,44,.35);filter:saturate(1.15) brightness(1.08)}
  .btn.ready::after{content:"";position:absolute;inset:0;background:linear-gradient(120deg,transparent 0%,rgba(255,255,255,.18) 45%,transparent 90%);
                    transform:translateX(-110%);animation:shine 1.25s linear infinite;pointer-events:none}
  @keyframes shine{to{transform:translateX(110%)}}

  /* Content */
  .wrap{max-width:980px;margin:0 auto;padding:var(--space)}
  .stack{display:flex;flex-direction:column;gap:var(--space)}

  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:var(--space);
        display:flex;gap:14px;align-items:stretch;transition:transform .18s ease,filter .18s ease,opacity .18s ease, box-shadow .18s ease}
  .card.locked{opacity:.58;filter:grayscale(1);transform:scale(.90)}
  .card.unlock-ready{border-color:var(--accent);box-shadow:0 0 0 1px rgba(255,255,255,.06) inset,0 14px 30px rgba(204,107,44,.28),0 0 24px rgba(204,107,44,.25)}
  .card.unlock-bounce{animation:bob 1.1s ease-in-out infinite}
  @keyframes bob{0%{transform:translateY(0) scale(.90)}50%{transform:translateY(-2px) scale(.905)}100%{transform:translateY(0) scale(.90)}}

  /* Left tap pad */
  .tapPad{position:relative;width:clamp(64px,12vw,90px);aspect-ratio:1/1;border-radius:16px;background:#12243b;border:1px solid #1a2f4a;
          display:flex;align-items:center;justify-content:center;font-size:clamp(28px,8vw,40px);user-select:none;-webkit-tap-highlight-color:transparent;
          transition:transform .02s ease,filter .12s ease,background .2s ease;cursor:pointer;overflow:visible}
  .tapPad:active{transform:translateY(1px) scale(.98);filter:brightness(1.08)}
  .float{position:absolute;left:50%;top:10%;transform:translateX(-50%);color:#ffe6c7;font-weight:800;text-shadow:0 1px 0 rgba(0,0,0,.6);
         animation:rise .7s ease-out forwards;pointer-events:none}
  @keyframes rise{0%{opacity:0;transform:translate(-50%,10px) scale(.9)}20%{opacity:1}100%{opacity:0;transform:translate(-50%,-24px) scale(1.05)}}

  /* Right column */
  .right{flex:1;display:flex;flex-direction:column;gap:10px;min-width:0}
  .ex-head{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .ex-title{font-size:var(--fs-2);margin:0}
  .muted{color:var(--muted)}

  /* Cooldown bar */
  .coolwrap{background:#0c1525;border:1px solid #223556;border-radius:10px;overflow:hidden}
  .coolbar{height:16px;background:#101a2a;position:relative}
  .coolfill{height:100%;width:0%;position:relative;background:linear-gradient(90deg,var(--accent) 0%, var(--accent-hi) 92%)}
  .coolfill::after{content:"";position:absolute;inset:0;background:
      repeating-linear-gradient(45deg, rgba(255,255,255,.16) 0 6px, transparent 6px 12px);
      mix-blend-mode:overlay;opacity:.65;animation:stripeMove 1.2s linear infinite}
  @keyframes stripeMove{from{background-position:0 0}to{background-position:60px 0}}

  /* Rep row */
  .repRow{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .repbar{flex:1;height:10px;border-radius:8px;background:#15341f;border:1px solid #204e2b;overflow:hidden;min-width:180px}
  .repfill{height:100%;width:0%;background:linear-gradient(90deg,#1fa24e,var(--rep))}
  .kv{color:#cfe0ff;background:#13223a;border:1px solid #203659;padding:6px 10px;border-radius:10px;font-size:14px}
</style>
</head>
<body>

<!-- Sticky Header -->
<div class="topbar">
  <div class="topwrap">
    <div class="title"><span class="icon">ðŸ’ª</span><h1>Fitness Frenzy</h1></div>

    <div class="hpPill">
      <span class="label">HP:</span>
      <span id="hp" class="val">0</span>
    </div>

    <div class="spacer"></div>

    <!-- Global Buy Quantity -->
    <div class="seg" id="qtyTop">
      <button class="segBtn active" data-q="1">Ã—1</button>
      <button class="segBtn" data-q="10">Ã—10</button>
    </div>

    <button id="saveBtn" class="btn secondary">Save</button>
    <button id="resetBtn" class="btn secondary">Reset</button>
  </div>
</div>

<div class="wrap"><div id="stack" class="stack"></div></div>
<div id="toast" class="toast" style="display:none"></div>

<script>
/* ===== Data / Config ===== */
const VERSION='ff-v1-5';
const SAVE_KEY='fitness_frenzy_'+VERSION;

/* Rep growth ~7% per rep */
const REP_GROWTH = 1.07;
/* Global buy quantity (header toggle) */
let BUY_QTY = 1;

const exercises = [
  { id:'walk', name:'Walking', icon:'ðŸš¶', baseHP:1,   baseCooldown:600,
    reps:0, repTarget:10, repBaseCost:4,  unlocked:true,  unlockCost:0,
    cooldown:600, lastTapAt:-Infinity, _repReady:false, _unlockReady:false, els:{} },
  { id:'jog',  name:'Jogging', icon:'ðŸƒ', baseHP:60,  baseCooldown:3000,
    reps:0, repTarget:10, repBaseCost:30, unlocked:false, unlockCost:60,
    cooldown:3000, lastTapAt:-Infinity, _repReady:false, _unlockReady:false, els:{} },
  { id:'sit',  name:'Sit-ups', icon:'ðŸ¤¸', baseHP:180, baseCooldown:2500,
    reps:0, repTarget:10, repBaseCost:90, unlocked:false, unlockCost:300,
    cooldown:2500, lastTapAt:-Infinity, _repReady:false, _unlockReady:false, els:{} },
  { id:'push', name:'Push-ups', icon:'ðŸ’ª', baseHP:400, baseCooldown:2000,
    reps:0, repTarget:10, repBaseCost:200, unlocked:false, unlockCost:1200,
    cooldown:2000, lastTapAt:-Infinity, _repReady:false, _unlockReady:false, els:{} },
];

const state = { hp:0, lastTS:performance.now() };

/* ===== Utils ===== */
const fmtTop = n => n>=1e9?(n/1e9).toFixed(2)+'B' : n>=1e6?(n/1e6).toFixed(2)+'M' : n>=1e3?(n/1e3).toFixed(2)+'K' : Math.floor(n).toString();
const fmtCost = n => n<1e3 ? n.toFixed(2) : (n<1e6 ? (n/1e3).toFixed(2)+'K' : (n<1e9 ? (n/1e6).toFixed(2)+'M' : (n/1e9).toFixed(2)+'B'));
const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
const perTap = e => e.baseHP * Math.pow(2, e.reps);
const cooldownMs = e => e.cooldown;
const canTap = (e, now)=> (now - e.lastTapAt) >= cooldownMs(e) - 1;

/* ===== SFX ===== */
let audioCtx=null;
function sfx(type){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const t=audioCtx.currentTime;
    const beep=(f,type='sine',dur=.22,vol=.07)=>{
      const o=audioCtx.createOscillator(); o.type=type; o.frequency.setValueAtTime(f,t);
      const g=audioCtx.createGain(); g.gain.setValueAtTime(vol,t); g.gain.exponentialRampToValueAtTime(.0001,t+dur);
      o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(t+dur);
    };
    if(type==='tap')      beep(660,'sine',.12,.06);
    if(type==='buy')      beep(440,'sine',.18,.08);
    if(type==='upgrade'){ beep(520,'sine',.2,.08);
                          const o=audioCtx.createOscillator(), g=audioCtx.createGain();
                          o.type='sine'; g.gain.setValueAtTime(.06,t); g.gain.exponentialRampToValueAtTime(.0001,t+.22);
                          o.frequency.setValueAtTime(520,t); o.frequency.exponentialRampToValueAtTime(880,t+.18);
                          o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(t+.24);}
    if(type==='ready'){   beep(760,'triangle',.16,.06); setTimeout(()=>beep(980,'triangle',.14,.05), 60); }
  }catch{}
}

/* ===== Persistence ===== */
function save(){
  localStorage.setItem(SAVE_KEY, JSON.stringify({
    hp: state.hp,
    exercises: exercises.map(e=>({id:e.id,reps:e.reps,repTarget:e.repTarget,unlocked:e.unlocked,cooldown:e.cooldown}))
  }));
  toast('Saved.');
}
function load(){
  const raw=localStorage.getItem(SAVE_KEY); if(!raw) return;
  try{
    const s=JSON.parse(raw);
    state.hp = s.hp ?? 0;
    if(Array.isArray(s.exercises)){
      for(const se of s.exercises){
        const e = exercises.find(x=>x.id===se.id); if(!e) continue;
        e.reps=se.reps ?? e.reps; e.repTarget=se.repTarget ?? e.repTarget;
        e.unlocked=se.unlocked ?? e.unlocked; e.cooldown=se.cooldown ?? e.baseCooldown;
      }
    }
  }catch{}
}

/* ===== UI Build ===== */
const ui = {
  hp: document.getElementById('hp'),
  saveBtn: document.getElementById('saveBtn'),
  resetBtn: document.getElementById('resetBtn'),
  qtyTop: document.getElementById('qtyTop'),
  stack: document.getElementById('stack'),
  toast: document.getElementById('toast')
};

function makeExerciseCard(e){
  const card = document.createElement('div');
  card.className='card'+(e.unlocked?'':' locked');

  const tapPad = document.createElement('div');
  tapPad.className='tapPad'; tapPad.textContent = e.icon;

  const right = document.createElement('div'); right.className='right';

  const head = document.createElement('div'); head.className='ex-head';
  head.innerHTML = `<div class="ex-title">${e.name}</div>
                    <div class="muted headRight"></div>`;

  // Unlocked internals
  const coolWrap = document.createElement('div'); coolWrap.className='coolwrap';
  coolWrap.innerHTML = `<div class="coolbar"><div class="coolfill"></div></div>`;

  const kvs = document.createElement('div');
  kvs.innerHTML = `<span class="kv">Per Tap: <strong class="kvTap">${perTap(e).toFixed(0)}</strong> HP</span>
                   <span class="kv">Reps: <strong class="kvReps">${e.reps}</strong></span>`;

  const repRow = document.createElement('div'); repRow.className='repRow';
  repRow.innerHTML = `<div class="repbar"><div class="repfill"></div></div>`;
  const buyRepBtn = document.createElement('button'); buyRepBtn.className='btn'; buyRepBtn.textContent='Buy Rep';
  repRow.appendChild(buyRepBtn);

  // Locked info (on card, not overlay)
  const lockedInfo = document.createElement('div');
  lockedInfo.className='repRow';
  lockedInfo.innerHTML = `<div class="kv">Unlock cost: <strong class="unlockCost">${fmtCost(e.unlockCost)}</strong> HP</div>`;
  const unlockBtn = document.createElement('button'); unlockBtn.className='btn'; unlockBtn.textContent='Unlock';
  lockedInfo.appendChild(unlockBtn);

  // Assemble right column
  right.appendChild(head);
  right.appendChild(coolWrap);
  right.appendChild(kvs);
  right.appendChild(repRow);
  right.appendChild(lockedInfo);

  card.appendChild(tapPad);
  card.appendChild(right);

  // store refs
  e.els = {
    card, tapPad,
    headRight: head.querySelector('.headRight'),
    coolFill: coolWrap.querySelector('.coolfill'),
    kvTap: kvs.querySelector('.kvTap'),
    kvReps: kvs.querySelector('.kvReps'),
    repFill: repRow.querySelector('.repfill'),
    buyRepBtn,
    lockedInfo, unlockBtn, unlockCostEl: lockedInfo.querySelector('.unlockCost'),
    coolWrap, kvs, repRow
  };

  // initial show/hide
  if(e.unlocked){ lockedInfo.style.display='none'; }
  else{ coolWrap.style.display='none'; kvs.style.display='none'; repRow.style.display='none'; }

  // wire events
  bindPress(tapPad, ()=> tap(e));
  bindPress(buyRepBtn, ()=> buyRep(e, BUY_QTY));
  bindPress(unlockBtn, ()=>{
    if(state.hp >= e.unlockCost){
      state.hp -= e.unlockCost; e.unlocked = true; sfx('buy');
      e.els.card.classList.remove('locked','unlock-ready','unlock-bounce');
      // reveal internals
      e.els.lockedInfo.style.display='none';
      e.els.coolWrap.style.display='block';
      e.els.kvs.style.display='block';
      e.els.repRow.style.display='flex';
      refreshExerciseUI(e); renderTop();
    }
  });

  return card;
}

function renderStack(){
  ui.stack.innerHTML='';
  exercises.forEach(e=>{ const c=makeExerciseCard(e); ui.stack.appendChild(c); refreshExerciseUI(e); });
}

/* ===== Global qty toggle ===== */
[...ui.qtyTop.querySelectorAll('.segBtn')].forEach(btn=>{
  btn.addEventListener('pointerdown', ev=>{
    ev.preventDefault();
    [...ui.qtyTop.querySelectorAll('.segBtn')].forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    BUY_QTY = parseInt(btn.dataset.q,10);
    // refresh all buttons/cost labels
    exercises.forEach(refreshExerciseUI);
  }, {passive:false});
});

/* ===== UI Updates ===== */
function refreshExerciseUI(e){
  // header right text: either cooldown countdown or "Locked"
  if(e.unlocked){
    e.els.headRight.textContent = `Cooldown: ${ (cooldownMs(e)/1000).toFixed(2) }s`;
  }else{
    e.els.headRight.textContent = `Locked`;
  }

  // core stats (only if unlocked)
  if(e.unlocked){
    e.els.kvTap.textContent = perTap(e).toFixed(0);
    e.els.kvReps.textContent = e.reps;
    e.els.repFill.style.width = (Math.min(e.reps / e.repTarget, 1)*100).toFixed(1)+'%';

    const cost = bulkRepCost(e, BUY_QTY);
    const canBuy = state.hp >= cost;
    e.els.buyRepBtn.textContent =
      (BUY_QTY===1 ? `Buy Rep (${fmtCost(cost)} HP)` : `Buy ${BUY_QTY} Reps (${fmtCost(cost)} HP)`);
    e.els.buyRepBtn.disabled = !canBuy;
    if(canBuy && !e._repReady){ e._repReady=true; e.els.buyRepBtn.classList.add('ready'); sfx('ready'); }
    if(!canBuy && e._repReady){ e._repReady=false; e.els.buyRepBtn.classList.remove('ready'); }
  }else{
    // locked card: show cost + unlock state
    e.els.unlockCostEl.textContent = fmtCost(e.unlockCost);
    const canUn = state.hp >= e.unlockCost;
    e.els.unlockBtn.disabled = !canUn;
    // visual attention on card + button
    if(canUn && !e._unlockReady){
      e._unlockReady=true;
      e.els.card.classList.add('unlock-ready','unlock-bounce');
      e.els.unlockBtn.classList.add('ready');
      sfx('ready');
    }
    if(!canUn && e._unlockReady){
      e._unlockReady=false;
      e.els.card.classList.remove('unlock-ready','unlock-bounce');
      e.els.unlockBtn.classList.remove('ready');
    }
  }
}

function renderTop(){ ui.hp.textContent = fmtTop(state.hp); }
function refreshAll(){ renderTop(); exercises.forEach(refreshExerciseUI); }

/* ===== Economy ===== */
function repUnitCost(e, offset=0){ return e.repBaseCost * Math.pow(REP_GROWTH, e.reps + offset); }
function bulkRepCost(e, qty){
  const base = e.repBaseCost * Math.pow(REP_GROWTH, e.reps);
  const cost = base * (Math.pow(REP_GROWTH, qty) - 1) / (REP_GROWTH - 1);
  return +cost.toFixed(2);
}
function buyRep(e, qty=1){
  if(!e.unlocked) return;
  const cost = bulkRepCost(e, qty);
  if(state.hp + 1e-9 < cost) return;
  state.hp -= cost;
  e.reps += qty;
  sfx('buy');
  checkUpgrade(e);
  refreshAll();
}
function checkUpgrade(e){
  while(e.reps >= e.repTarget){
    e.reps -= e.repTarget;
    e.repTarget *= 2;
    e.cooldown = Math.max(100, Math.floor(e.cooldown/2));
    toast('Upgraded! Cooldown halved.');
    sfx('upgrade');
  }
}

/* ===== Tapping, Floats & Cooldown ===== */
function tap(e){
  const now=performance.now();
  if(!e.unlocked || !canTap(e, now)) return;
  e.lastTapAt = now;
  const gain = perTap(e);
  state.hp += gain;
  sfx('tap');
  spawnFloat(e, `+${gain.toFixed(0)}`);
  refreshAll();
}
function spawnFloat(e, text){
  const span=document.createElement('div');
  span.className='float'; span.textContent=text;
  const jitter = (Math.random()*16 - 8)|0;
  span.style.left = `calc(50% + ${jitter}px)`;
  e.els.tapPad.appendChild(span);
  setTimeout(()=>span.remove(), 800);
}
function updateCooldownUI(e){
  if(!e.unlocked) return;
  const cd = cooldownMs(e), now = performance.now(), since = now - e.lastTapAt, pct = clamp(since/cd,0,1);
  // bar fill only; countdown sits in header (we update it here)
  if(cd <= 100){
    e.els.coolFill.style.width = '100%';
    e.els.headRight.textContent = `Cooldown: 0.00s`;
    return;
  }
  e.els.coolFill.style.width = (pct*100).toFixed(1)+'%';
  if(pct < 1){
    const remain = Math.max(0, (cd - since)/1000);
    const shown = Math.max(0.01, remain);
    e.els.headRight.textContent = `Cooldown: ${shown.toFixed(2)}s`;
  } else {
    e.els.headRight.textContent = `Cooldown: 0.00s`;
  }
}

/* ===== Loop ===== */
function tick(ts){
  state.lastTS = ts;
  exercises.forEach(updateCooldownUI);
  requestAnimationFrame(tick);
}

/* ===== Toast (subtle) ===== */
let toastTimer=null;
function toast(msg){
  ui.toast.textContent=msg; ui.toast.style.display='block';
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>{ ui.toast.style.display='none'; }, 1000);
}

/* ===== Bind & Boot ===== */
function bindPress(el, fn){
  el.addEventListener('pointerdown', e=>{ e.preventDefault(); fn(e); }, {passive:false});
  el.addEventListener('keydown', e=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); fn(e);} });
}
ui.saveBtn.addEventListener('click', save);
ui.resetBtn.addEventListener('click', ()=>{ if(!confirm('Reset your progress?')) return; localStorage.removeItem(SAVE_KEY); location.reload(); });

function boot(){ load(); renderTop(); renderStack(); requestAnimationFrame(tick); setInterval(save, 20000); }
boot();
</script>
</body>
</html>
