<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Fitness Frenzy ‚Äì Baseline Safe Build</title>
<style>
:root{
  --bg:#0f1421; --bg2:#0b1220; --ink:#eaf1fb; --muted:#9fb0c6;
  --card:#152136; --edge:rgba(255,255,255,.06);
  --accent:#ff7a1a; --accent2:#ffc38f; --good:#2dd36f;
}
*{box-sizing:border-box}
html,body{height:100%} html{-webkit-text-size-adjust:100%}
body{
  margin:0;color:var(--ink);font:16px/1.45 system-ui,Segoe UI,Arial;
  background:
    radial-gradient(900px 600px at -10% -20%,rgba(58,160,255,.15),transparent),
    radial-gradient(1000px 700px at 110% 10%,rgba(255,122,26,.10),transparent),
    linear-gradient(180deg,var(--bg),var(--bg2));
  -webkit-tap-highlight-color: transparent;
}

/* Header */
header{position:sticky;top:0;z-index:1000;display:flex;align-items:center;gap:12px;
  padding:10px 14px;background:rgba(15,21,33,.85);border-bottom:1px solid var(--edge);backdrop-filter:blur(8px)}
.hp-wrap{display:flex;align-items:center;gap:10px;min-width:0;flex:1}
.hp-icon{font-size:26px;filter:drop-shadow(0 2px 8px rgba(0,0,0,.35))}
.hp{flex:1;font:900 clamp(22px,4.2vw,36px)/1 system-ui;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hp small{font-weight:800;opacity:.9;background:rgba(255,255,255,.08);padding:.16em .45em;border-radius:.35em;margin-left:.45rem}

/* Layout */
.wrap{max-width:760px;margin:14px auto 100px;padding:0 14px}

/* Card */
.card{background:var(--card);border-radius:14px;padding:12px;margin:12px 0;
  box-shadow:0 10px 22px rgba(0,0,0,.36), inset 0 0 0 1px var(--edge);
  display:grid;grid-template-columns:150px 1fr 220px;gap:12px;align-items:center;min-height:132px}
@media (max-width:760px){.card{grid-template-columns:1fr}.actions{grid-template-columns:1fr}}

.meta h3{margin:0 0 4px;font:800 clamp(16px,3.8vw,18px)/1.15 system-ui}
.meta .sub{color:var(--muted);font-size:12.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* Tap area */
.avatarbtn{
  position:relative;display:grid;place-items:center;height:120px;border-radius:14px;border:2px dashed #7ff2b0;
  background:linear-gradient(180deg,#0c1e16,#0f271a);color:#cffff1;cursor:pointer;user-select:none;overflow:hidden
}
.emoji{font-size:64px;filter:drop-shadow(0 4px 7px rgba(0,0,0,.35))}
.avatarbtn.ready{box-shadow:0 0 0 3px rgba(39,210,103,.28) inset}
.avatarbtn.animate .emoji{animation:bop .2s ease} @keyframes bop{50%{transform:scale(1.12)}}

/* GREEN speed-progress bar (inside avatar) */
.avatar-mini{
  position:absolute;left:8px;right:8px;bottom:8px;height:12px;border-radius:8px;
  background:#0b1219;overflow:hidden;box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);
  display:flex;align-items:center;justify-content:center;font:900 11px/1 system-ui;color:#0b1219;
}
.avatar-mini i{position:absolute;left:0;top:0;height:100%;width:0;background:linear-gradient(90deg,#9cffbd,#2dd36f)}
.avatar-mini span{position:relative;z-index:1;mix-blend-mode:luminosity}

/* ORANGE cooldown bar */
.bar{height:14px;background:#0b1219;border-radius:8px;overflow:hidden;margin-top:10px}
.bar i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.bar.pulse i{width:100%!important}

/* Buttons */
.actions{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.btn{height:44px;display:flex;align-items:center;justify-content:center;border:1px solid var(--edge);
  border-radius:12px;padding:0 12px;font-weight:900;background:#0e1724;color:#fff;cursor:pointer;position:relative}
.btn[disabled]{opacity:.5;cursor:not-allowed}
.action{background:linear-gradient(180deg,#ff8b3a,#ff7a1a);color:#1b0e03;border-color:transparent}
.btn.glitter.available::after{content:"";position:absolute;inset:0;pointer-events:none;border-radius:12px;
  background:linear-gradient(120deg,transparent 0%,rgba(255,255,255,.18) 25%,rgba(255,255,255,.35) 33%,transparent 45%);
  transform:translateX(-120%);animation:shine 1.15s ease-in-out infinite;filter:blur(.6px)}
@keyframes shine{0%{transform:translateX(-120%)}60%{transform:translateX(0)}100%{transform:translateX(120%)}}
</style>
</head>
<body>
<header>
  <div class="hp-wrap">
    <div class="hp-icon">üí™</div>
    <div class="hp" id="hp">0.00 <small>HP</small></div>
  </div>
</header>

<div class="wrap" id="list">
  <!-- Single baseline exercise -->
  <div class="card" id="card-walk">
    <button type="button" class="avatarbtn" id="tap-walk" aria-label="Perform Walking">
      <div class="emoji">üëü</div>
      <div class="avatar-mini"><i id="mini-walk"></i><span id="miniTxt-walk">0/0</span></div>
    </button>
    <div class="meta">
      <h3>Walking</h3>
      <div class="sub">Reps Lv.<b id="replv-walk">1</b> ‚Ä¢ Gain/tap: <b id="gain-walk">1</b> ‚Ä¢ Cooldown: <b id="cd-walk">0.50</b>s</div>
      <div class="bar" id="cool-walk"><i id="cooli-walk"></i></div>
    </div>
    <div class="actions">
      <button class="btn action" id="rep-walk">Reps | 10 HP</button>
      <button class="btn" id="dummy" disabled>üßë‚Äçüíº Coach (later)</button>
    </div>
  </div>
</div>

<audio id="clicksnd" preload="auto"></audio>

<script>
/* ====== Minimal state ====== */
const STORAGE="ff_baseline_safe_v1";
let state = {
  hp: 0,
  item: {
    reps: 1,             // increases HP per tap only
    tier: 0,             // each full green bar ‚Üí +1 tier (2x speed)
    steps: 0,
    stepsReq: 8,         // start requirement for 2x (then grows)
    next: 0              // next allowed activation time (sec)
  }
};

/* ====== Config ====== */
const BASE_GAIN = 1;
const BASE_INTERVAL = 0.50; // seconds
const REP_COST_BASE = 10;
const REP_COST_MULT = 1.28;
const GAIN_MULT_PER_REP = 1.15;
const MIN_INTERVAL = 0.10;

/* ====== Helpers ====== */
const id=s=>document.getElementById(s);
const now=()=>performance.now()/1000;
function fmtHP(n){const a=Math.abs(n),d=v=>v.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  if(a>=1e9)return d(n/1e9)+"B"; if(a>=1e6)return d(n/1e6)+"M"; if(a>=1e3)return d(n/1e3)+"K"; return d(n);}
function fmtCost(n){n=Math.floor(n); const a=Math.abs(n),f=v=>Number.isInteger(v)?v.toString():v.toFixed(1).replace(/\.0$/,'');
  if(a>=1e9)return f(n/1e9)+"B"; if(a>=1e6)return f(n/1e6)+"M"; if(a>=1e3)return f(n/1e3)+"K"; return String(n);}

function gainPerTap(reps){ return Math.max(1, Math.floor(BASE_GAIN * Math.pow(GAIN_MULT_PER_REP, Math.max(0,reps-1)))); }
function nextRepCost(repsNext){ return Math.floor(REP_COST_BASE * Math.pow(REP_COST_MULT, Math.max(0,repsNext-1))); }
function intervalFor(tier){ return Math.max(MIN_INTERVAL, BASE_INTERVAL / Math.pow(2, Math.max(0,tier))); }

/* ====== Audio (simple, robust) ====== */
let AC=null, master=null;
function ensureAC(){ try{ if(AC) return; const C=window.AudioContext||window.webkitAudioContext; AC=new C(); master=AC.createGain(); master.gain.value=.9; master.connect(AC.destination);}catch{} }
function s_click(){ try{ ensureAC(); const t=AC.currentTime; const o=AC.createOscillator(), g=AC.createGain(); o.type="triangle"; o.frequency.value=420; o.connect(g); g.connect(master); g.gain.setValueAtTime(.18,t); g.gain.exponentialRampToValueAtTime(.0001,t+.14); o.start(t); o.stop(t+.16);}catch{} }
function s_up(){ try{ ensureAC(); const t=AC.currentTime; const o=AC.createOscillator(), g=AC.createGain(); o.type="square"; o.frequency.value=980; o.connect(g); g.connect(master); g.gain.setValueAtTime(.22,t); g.gain.exponentialRampToValueAtTime(.0001,t+.22); o.start(t); o.stop(t+.24);}catch{} }

/* ====== Save/Load ====== */
function load(){ try{const raw=localStorage.getItem(STORAGE); if(raw){ const s=JSON.parse(raw); if(s&&s.item){ state=s; } }}catch{} }
function save(){ try{localStorage.setItem(STORAGE, JSON.stringify(state));}catch{} }

/* ====== Perform ====== */
function perform(){
  const t=now();
  const interval = intervalFor(state.item.tier);
  if(t < state.item.next) return false;              // still cooling down

  state.item.next = t + interval;                    // set next ready time
  const gain = gainPerTap(state.item.reps);          // HP gain based on reps
  state.hp += gain;

  s_click();                                         // SFX only on REAL activation
  flashTap();                                        // small tap animation
  render();
  save();
  return true;
}

/* ====== Reps purchase ====== */
function buyRep(){
  const next = state.item.reps + 1;
  const cost = nextRepCost(next);
  if(state.hp < cost) return;

  state.hp -= cost;
  state.item.reps = next;

  // advance green speed bar (when filled ‚Üí 2x faster)
  state.item.steps += 1;
  if(state.item.steps >= state.item.stepsReq){
    state.item.steps = 0;
    state.item.tier += 1;                       // halves cooldown
    state.item.stepsReq = Math.ceil(state.item.stepsReq*1.35 + 2);
  }
  s_up();
  render();
  save();
}

/* ====== UI wiring ====== */
function render(){
  // HP header
  id("hp").innerHTML = `${fmtHP(state.hp)} <small>HP</small>`;

  // labels
  id("replv-walk").textContent = state.item.reps;
  id("gain-walk").textContent  = fmtCost(gainPerTap(state.item.reps));
  id("cd-walk").textContent    = intervalFor(state.item.tier).toFixed(2).replace(/\.00$/,'');

  // reps button
  const nextCost = nextRepCost(state.item.reps+1);
  const repBtn = id("rep-walk");
  repBtn.textContent = `Reps | ${fmtCost(nextCost)} HP`;
  if(state.hp >= nextCost){ repBtn.disabled=false; repBtn.classList.add("glitter","available"); }
  else { repBtn.disabled=true; repBtn.classList.remove("glitter","available"); }

  // cooldown bar (orange)
  const wrap = id("cool-walk"), bar = id("cooli-walk");
  const t=now(), left = Math.max(0, (state.item.next||0) - t);
  const interval = intervalFor(state.item.tier);
  const pct = 1 - Math.min(1, left/interval);
  if(interval<=0.18){ wrap.classList.add("pulse"); bar.style.width="100%"; }
  else{ wrap.classList.remove("pulse"); bar.style.width = Math.round(pct*100)+"%"; }

  // ready glow + tiny bop
  const tapBtn = id("tap-walk");
  tapBtn.classList.toggle("ready", left<=0);
  tapBtn.classList.remove("animate"); void tapBtn.offsetWidth; tapBtn.classList.add("animate");

  // green speed bar (fraction)
  const mini = id("mini-walk"), miniTxt=id("miniTxt-walk");
  const x=state.item.steps, y=state.item.stepsReq;
  const p = Math.max(0,Math.min(1, y? x/y:0))*100;
  mini.style.setProperty("--p", p.toFixed(0));
  mini.style.position="absolute";
  mini.querySelector("i").style.width=p.toFixed(0)+"%";
  miniTxt.textContent = `${x}/${y}`;
}
function flashTap(){ /* visual hint already handled by .animate */ }

/* events */
function bind(){
  id("tap-walk").addEventListener("pointerdown", e=>{e.preventDefault(); perform();},{passive:false});
  id("tap-walk").addEventListener("click", e=>{e.preventDefault(); perform();});
  id("rep-walk").addEventListener("click", e=>{e.preventDefault(); buyRep();});
}

/* loop */
function loop(){ render(); requestAnimationFrame(loop); }

/* boot */
load(); bind(); render(); loop();

/* optional: clear stale data quickly by typing in console:
   localStorage.removeItem('ff_baseline_safe_v1')
*/
</script>
</body>
</html>
