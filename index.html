<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Fitness Frenzy â€” Balanced Core + Debug</title>
<style>
  :root{ --bg:#0f1421; --bg2:#0b1220; --ink:#eaf1fb; --muted:#9fb0c6; --card:#152136; --edge:rgba(255,255,255,.08);
         --accent:#ff7a1a; --accent2:#ffc38f; --good:#2dd36f; }
  *{box-sizing:border-box}
  html,body{height:100%} html{-webkit-text-size-adjust:100%}
  body{ margin:0;color:var(--ink);font:16px/1.45 system-ui,Segoe UI,Arial;
        background:
          radial-gradient(900px 600px at -10% -20%,rgba(58,160,255,.15),transparent),
          radial-gradient(1000px 700px at 110% 10%,rgba(255,122,26,.10),transparent),
          linear-gradient(180deg,var(--bg),var(--bg2));
        -webkit-tap-highlight-color: transparent; }
  header{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:12px;
    padding:10px 14px;background:rgba(15,21,33,.85);border-bottom:1px solid var(--edge);backdrop-filter:blur(8px)}
  .hp-wrap{display:flex;align-items:center;gap:10px;min-width:0;flex:1}
  .hp-icon{font-size:26px;filter:drop-shadow(0 2px 8px rgba(0,0,0,.35))}
  .hp{flex:1;font:900 clamp(22px,4.2vw,36px)/1 system-ui;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .hp small{font-weight:800;opacity:.9;background:rgba(255,255,255,.08);padding:.16em .45em;border-radius:.35em;margin-left:.45rem}

  .wrap{max-width:760px;margin:14px auto 100px;padding:0 14px}
  .card{background:var(--card);border-radius:14px;padding:12px;margin:12px 0;
    box-shadow:0 10px 22px rgba(0,0,0,.36), inset 0 0 0 1px var(--edge);
    display:grid;grid-template-columns:160px 1fr;gap:12px;align-items:center;min-height:140px}
  @media (max-width:700px){.card{grid-template-columns:1fr}}

  .meta h3{margin:0 0 6px;font:800 clamp(16px,3.8vw,18px)/1.15 system-ui}
  .meta .sub{color:var(--muted);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

  .tap{position:relative;display:grid;place-items:center;height:120px;border-radius:14px;border:2px dashed #7ff2b0;
    background:linear-gradient(180deg,#0c1e16,#0f271a);color:#cffff1;cursor:pointer;user-select:none;overflow:hidden}
  .emoji{font-size:64px;filter:drop-shadow(0 4px 7px rgba(0,0,0,.35))}
  .tap.ready{box-shadow:0 0 0 3px rgba(39,210,103,.28) inset}
  .tap.bop .emoji{animation:bop .18s ease} @keyframes bop{50%{transform:scale(1.12)}}

  /* Orange cooldown */
  .bar{height:14px;background:#0b1219;border-radius:8px;overflow:hidden}
  .bar i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}

  /* Green speed bar w/ fraction */
  .mini{position:relative;height:14px;background:#0b1219;border-radius:8px;overflow:hidden;margin-top:8px}
  .mini i{display:block;height:100%;width:0;background:linear-gradient(90deg,#9cffbd,#2dd36f)}
  .mini .lbl{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    font:900 11px/1 system-ui;color:#cfead7;text-shadow:0 1px 2px rgba(0,0,0,.5);pointer-events:none}

  .actions{display:grid;grid-template-columns:1fr;gap:8px;margin-top:10px}
  .btn{height:44px;display:flex;align-items:center;justify-content:center;border:1px solid var(--edge);
    border-radius:12px;padding:0 12px;font-weight:900;background:#0e1724;color:#fff;cursor:pointer;position:relative;z-index:1}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .action{background:linear-gradient(180deg,#ff8b3a,#ff7a1a);color:#1b0e03;border-color:transparent}
  .btn.glitter.available::after{content:"";position:absolute;inset:0;pointer-events:none;border-radius:12px;
    background:linear-gradient(120deg,transparent 0%,rgba(255,255,255,.18) 25%,rgba(255,255,255,.35) 33%,transparent 45%);
    transform:translateX(-120%);animation:shine 1.15s ease-in-out infinite;filter:blur(.6px)}
  @keyframes shine{0%{transform:translateX(-120%)}60%{transform:translateX(0)}100%{transform:translateX(120%)}}

  /* +HP float */
  .float{position:absolute;left:50%;transform:translateX(-50%);pointer-events:none;font-weight:900;text-shadow:0 1px 2px rgba(0,0,0,.35)}

  /* Safety */
  #intro, .modal-backdrop, .overlay, .backdrop { pointer-events:none !important; }
  #tap, #tap * { pointer-events:auto !important; z-index:2; }
</style>
</head>
<body>
<header>
  <div class="hp-wrap">
    <div class="hp-icon">ðŸ’ª</div>
    <div class="hp" id="hp">0.00 <small>HP</small></div>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <button id="tap" class="tap" aria-label="Tap to perform"><div class="emoji">ðŸ‘Ÿ</div></button>
    <div class="meta">
      <h3>Walking</h3>
      <div class="sub">Reps Lv.<b id="replv">1</b> â€¢ Gain/tap: <b id="gain">1</b> â€¢ Cooldown: <b id="cd">1.00</b>s</div>
      <div class="bar"><i id="cool"></i></div>
      <div class="mini"><i id="mini"></i><div class="lbl" id="miniLbl">0/0</div></div>
      <div class="actions">
        <button class="btn action" id="rep">Reps Ã—2 (early) â†’ Ã—1.4 (later) | 12 HP</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ------- State ------- */
let hp=0, reps=1, tier=0, steps=0, stepsReq=6, nextReadyMs=0;

/* ------- Tunables (BALANCE) ------- */
const BASE_GAIN=1;                        // Lv1 gain
const BASE_CD_S=1.00, MIN_CD_S=0.25;     // cooldown halves per tier; floor at 0.25s to avoid flicker
const REP_BASE=12, REP_MULT=1.8;         // cost grows quickly after a few upgrades
const STEP_GROW=1.85, STEP_BONUS=4;      // 6 â†’ 15 â†’ 32 â†’ 63 â€¦

/* Gain/tap curve:
   - Reps 1..3: Ã—1, Ã—2, Ã—4  (spicy start)
   - Reps 4+:   Ã—(4 * 1.4^(reps-3))  (flatter, keeps progression sane)
*/
function repsMultiplier(r){
  if(r<=1) return 1;
  if(r===2) return 2;
  if(r===3) return 4;
  return 4 * Math.pow(1.4, r-3);
}

/* ------- Helpers ------- */
const $ = s => document.getElementById(s);
function fmtHP(n){ const a=Math.abs(n), d=v=>v.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  if(a>=1e9) return d(n/1e9)+"B"; if(a>=1e6) return d(n/1e6)+"M"; if(a>=1e3) return d(n/1e3)+"K"; return d(n); }
function gainPerTap(){ return Math.max(1, Math.floor(BASE_GAIN * repsMultiplier(reps))); }
function nextRepCost(){ return Math.max(1, Math.floor(REP_BASE * Math.pow(REP_MULT, Math.max(0,reps-1)))); }
function intervalMs(){ let s = BASE_CD_S / Math.pow(2, tier); if(s<MIN_CD_S) s=MIN_CD_S; return Math.round(s*1000); }
function canFire(){ return Date.now() >= nextReadyMs; }

/* ------- Audio (tiny) ------- */
let AC=null, master=null;
function ensureAC(){ try{ if(AC) return; const C=window.AudioContext||window.webkitAudioContext; AC=new C();
  master=AC.createGain(); master.gain.value=.9; master.connect(AC.destination);}catch(e){} }
function s_click(){ try{ ensureAC(); const t=AC.currentTime; const o=AC.createOscillator(),g=AC.createGain();
  o.type="triangle"; o.frequency.value=420; o.connect(g); g.connect(master); g.gain.setValueAtTime(.16,t);
  g.gain.exponentialRampToValueAtTime(.0001,t+.12); o.start(t); o.stop(t+.14);}catch(e){} }
function s_up(){ try{ ensureAC(); const t=AC.currentTime; const o=AC.createOscillator(),g=AC.createGain();
  o.type="square"; o.frequency.value=980; o.connect(g); g.connect(master); g.gain.setValueAtTime(.2,t);
  g.gain.exponentialRampToValueAtTime(.0001,t+.2); o.start(t); o.stop(t+.22);}catch(e){} }

/* ------- VFX ------- */
function bopTap(){ const el=$('tap'); if(!el) return; el.classList.remove('bop'); void el.offsetWidth; el.classList.add('bop'); }
function floatHP(anchor, text){
  if(!anchor) return;
  const r = anchor.getBoundingClientRect();
  const n = document.createElement('div');
  n.className='float'; n.textContent=text;
  n.style.left = (r.left + r.width/2) + 'px';
  n.style.top  = (r.top + 10 + window.scrollY) + 'px';
  document.body.appendChild(n);
  n.animate([{transform:'translate(-50%,0) scale(1)', opacity:1, color:'#fff'},
             {transform:'translate(-50%,-40px) scale(1.05)', opacity:0, color:'#ffdea8'}],
            {duration:800, easing:'ease-out'});
  setTimeout(()=>n.remove(),820);
}

/* ------- Actions ------- */
function perform(){
  if(!canFire()) return;
  nextReadyMs = Date.now() + intervalMs();
  const g = gainPerTap();
  hp += g;
  s_click(); bopTap(); floatHP($('tap'), `+${g} HP`);
  render();
}
function buyRep(){
  const cost = nextRepCost();
  if(hp < cost) return;
  hp -= cost;
  reps += 1;        // boosts Gain/tap
  steps += 1;       // contributes to speed tier
  if(steps >= stepsReq){
    steps = 0;
    tier += 1;      // halves cooldown
    stepsReq = Math.ceil(stepsReq * STEP_GROW + STEP_BONUS);
  }
  s_up(); render();
}

/* ------- Render ------- */
function render(){
  const hpEl=$('hp'), replvEl=$('replv'), gainEl=$('gain'), cdEl=$('cd'),
        repBtn=$('rep'), cool=$('cool'), tapEl=$('tap'),
        mini=$('mini'), miniLbl=$('miniLbl');

  if(hpEl) hpEl.innerHTML = `${fmtHP(hp)} <small>HP</small>`;
  if(replvEl) replvEl.textContent = reps;
  if(gainEl)  gainEl.textContent  = gainPerTap();
  if(cdEl)    cdEl.textContent    = (intervalMs()/1000).toFixed(2).replace(/\.00$/,'');

  const cost = nextRepCost();
  if(repBtn){
    repBtn.textContent = `Reps Ã—2 (early) â†’ Ã—1.4 (later) | ${cost.toLocaleString()} HP`;
    const can = hp >= cost;
    repBtn.disabled = !can;
    repBtn.classList.toggle('glitter', can);
    repBtn.classList.toggle('available', can);
  }

  // cooldown bar & glow
  const nowMs = Date.now(), dur = intervalMs(), left = Math.max(0, nextReadyMs - nowMs);
  const pct = dur ? 1 - Math.min(1, left/dur) : 1;
  if(cool) cool.style.width = Math.round(pct*100)+'%';
  if(tapEl) tapEl.classList.toggle('ready', left<=0);

  // green progress bar + fraction
  const p2 = stepsReq ? Math.round((steps/stepsReq)*100) : 0;
  if(mini) mini.style.width = Math.min(100, p2)+'%';
  if(miniLbl) miniLbl.textContent = `${steps}/${stepsReq}`;
}

/* ------- Safe binding & boot ------- */
function bind(id, ev, fn){
  const el = document.getElementById(id);
  if(!el){ const err=document.getElementById('ffErr'); if(err) err.textContent=`DOM issue: #${id} not found`; return; }
  el.addEventListener(ev, fn);
}
function boot(){ bind('tap','click', ()=>{ ensureAC(); perform(); });
                 bind('rep','click', ()=>{ ensureAC(); buyRep(); });
                 setInterval(render, 60); render(); }
if(document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', boot); } else { boot(); }
</script>

<!-- ==================== DEBUG START ==================== -->
<style>
  #ffDebug{position:fixed;inset:auto 8px 8px 8px;background:#0b0f18;color:#ffb4b4;
    border:1px solid #311; border-radius:10px; padding:10px; font:12px/1.35 ui-monospace,monospace;
    z-index:999999}
  #ffDebug b{color:#fff}
</style>
<div id="ffDebug">
  <div><b>Fitness Frenzy Debug</b></div>
  <div id="ffErr">No errors yet.</div>
  <div id="ffClick">No clicks yet.</div>
  <div id="ffTop">Top element: (waiting)</div>
</div>
<script>
(function(){
  window.addEventListener('error', function(e){
    var where=(e.filename||'')+(e.lineno?(':'+e.lineno):'');
    document.getElementById('ffErr').textContent = 'JS error: ' + e.message + ' @ ' + where;
  });
  document.addEventListener('click', function(e){
    const id = e.target && (e.target.id || e.target.tagName);
    document.getElementById('ffClick').textContent = 'Last click on: ' + id;
  }, true);
  function probe(){
    var tap = document.getElementById('tap'); var info = document.getElementById('ffTop');
    if(!tap){ info.textContent = 'Top element over tap: (no #tap on page)'; return; }
    var r = tap.getBoundingClientRect(); var x = Math.round(r.left + r.width/2), y = Math.round(r.top + r.height/2);
    var el = document.elementFromPoint(x, y);
    info.textContent = 'Top element over tap: ' + (el ? (el.id || el.tagName) : 'none');
  }
  setInterval(probe, 500);
})();
</script>
<!-- ===================== DEBUG END ===================== -->
</body>
</html>
