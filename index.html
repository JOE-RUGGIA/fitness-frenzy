<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Fitness Frenzy â€” V1.1.1 (New Game fix)</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<style>
/* =========================
   THEME TOKENS
   ========================= */
:root{
  --bg:#0a1320;
  --card:#0f1b2b;
  --ink:#e9eef3;
  --muted:#9fb1c8;
  --border:#223556;
  --accent:#cc6b2c;       /* burnt orange */
  --accent-hi:#ffb357;
  --brandBlue:#2b6cb0;
  --rep:#22c55e;          /* green */
  --pillBg:#132647;
  --pillBr:#2a4a78;
  --space:clamp(10px,2.2vw,18px);
  --r:16px;
  --barH:18px;
  --repband:15%;
}

/* Reset-ish */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--ink);
  font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
img,video{max-width:100%;display:block}

/* =========================
   TOP BAR (STICKY)
   ========================= */
.topbar{position:sticky;top:0;z-index:1000;background:rgba(10,19,32,.95);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
.topwrap{max-width:1024px;margin:0 auto;padding:10px var(--space) 6px;display:grid;grid-template-columns:auto 1fr auto;grid-template-rows:auto auto;gap:10px 12px;align-items:center}
.leftRow{display:flex;align-items:center;gap:12px}
.avatarBtn{position:relative;width:56px;height:56px;border-radius:50%;overflow:hidden;border:2px solid #2a446c;background:#0b1626;cursor:pointer}
.avatarBtn img{width:100%;height:100%;object-fit:cover}
.notifDot{position:absolute;right:-4px;top:-4px;width:18px;height:18px;border-radius:50%;box-shadow:0 0 0 2px rgba(10,19,32,.95);display:none}
.notifDot.show{display:block}
.notifDot.upgrade{background:var(--accent);}   /* ORANGE when upgrade available */
.notifDot.coach{background:#39d98a;}          /* GREEN when only coach available */

.logoImg{height:36px;width:auto;display:block;filter:drop-shadow(0 2px 4px rgba(0,0,0,.25))}
.qtyGroup{justify-self:end;display:inline-flex;border:1px solid #2b3d5a;border-radius:12px;overflow:hidden}
.qtyBtn{background:#13233b;color:#cfe0ff;border:0;padding:8px 12px;font-weight:800;cursor:pointer}
.qtyBtn.active{background:var(--accent);color:#fff}
.hpRow{grid-column:1/-1;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.hpPill{display:flex;align-items:baseline;gap:6px;padding:8px 14px;border-radius:999px;background:linear-gradient(135deg,#132647,#1d3a61);border:1px solid var(--pillBr)}
.hpLabel{font-weight:900;color:var(--accent)}
.hpVal{font-weight:900;font-variant-numeric:tabular-nums;min-width:10ch;text-align:left}
.buffBar{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.buff{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid #3b4f73;background:#132647}
.buff .emoji{font-size:18px}
.buff .time{font-variant-numeric:tabular-nums}

/* =========================
   LAYOUT
   ========================= */
.wrap{max-width:1024px;margin:0 auto;padding:var(--space)}
.stack{display:flex;flex-direction:column;gap:var(--space)}
/* Cards */
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:var(--space);display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:stretch;transition:transform .18s ease, filter .18s ease, opacity .18s ease}
.card .left{position:relative;width:clamp(86px,18vw,120px);aspect-ratio:1;border-radius:14px;background:#102036;border:1px solid #223b60;display:flex;align-items:center;justify-content:center;overflow:hidden}
.card .left img{width:100%;height:100%;object-fit:contain}
.card .left video{width:100%;height:100%;object-fit:contain}
.lvlBadge{position:absolute;left:6px;top:6px;background:linear-gradient(135deg,#203a63,#32578e);border:1px solid #4776b8;color:#fff;font-weight:900;border-radius:8px;padding:2px 6px;font-size:12px}
.coachBadge{position:absolute;right:6px;top:6px;border-radius:8px;border:1px solid #4776b8;background:#203a63;padding:2px}
.coachBadge img{width:18px;height:18px;object-fit:cover;border-radius:4px}

.repBand{position:absolute;left:0;right:0;bottom:0;height:var(--repband);background:#14361f;border-top:1px solid #204e2b;display:flex;align-items:center;justify-content:center;overflow:hidden}
.repFill{position:absolute;left:0;top:0;height:100%;width:0%;background:linear-gradient(90deg,#1fa24e,var(--rep))}
.repText{position:relative;font-size:12px;color:#cfead6;font-weight:700;text-shadow:0 1px 0 rgba(0,0,0,.4)}

.right{display:flex;flex-direction:column;gap:8px;min-width:0}
.title{font-size:clamp(16px,3vw,20px);margin:0}
.coolRow{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
.cool{flex:1;background:#0c1525;border:1px solid #223556;border-radius:12px;overflow:hidden}
.coolBar{height:var(--barH);background:#101a2a;position:relative}
.coolFill{height:100%;width:100%;background:linear-gradient(90deg,var(--accent) 0%,var(--accent-hi) 92%);position:relative}
.coolFill::after{content:"";position:absolute;inset:0;background:repeating-linear-gradient(45deg,rgba(255,255,255,.2) 0 6px,transparent 6px 12px);opacity:.65;mix-blend-mode:overlay;animation:stripe 1.2s linear infinite}
@keyframes stripe{to{background-position:60px 0}}
.coolTime{min-width:60px;text-align:right;font-variant-numeric:tabular-nums;color:#cfe0ff}
.metaRow{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between}
.kv{background:#13223a;border:1px solid #203659;border-radius:10px;padding:6px 10px;color:#cfe0ff;font-size:14px}
.chips{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.repsBtn{padding:10px 14px;border:0;border-radius:12px;font-weight:800;cursor:pointer}
.repsBtn.ready{background:var(--accent);color:#fff;box-shadow:0 8px 22px rgba(204,107,44,.35)}
.repsBtn:not(.ready){background:#1a2a40;color:#d7e3f5}

/* Locked */
.card.locked{opacity:.58;filter:grayscale(1);transform:scale(.94)}
.lockTitle{font-weight:800;margin:0 0 6px 0;color:#cbd7ea}
.unlockRow{display:flex;align-items:center;gap:10px}
.unlockPill{padding:10px 16px;border-radius:999px;background:#142743;border:1px solid #27456d;color:#ffd6a8;font-weight:900;cursor:not-allowed}
.unlockPill.ready{background:linear-gradient(135deg,var(--accent),var(--accent-hi));color:#fff;border-color:#e89d6b;cursor:pointer;box-shadow:0 12px 26px rgba(204,107,44,.35)}
.card.unlockPulse{animation:unlockPulse .9s ease-in-out infinite}
@keyframes unlockPulse{0%{transform:scale(.94)}50%{transform:scale(.955)}100%{transform:scale(.94)}}

/* Float +HP text */
.float{position:fixed;left:0;top:0;transform:translate(-50%,-10px);color:#ffe6c7;font-weight:900;text-shadow:0 1px 0 rgba(0,0,0,.6);animation:rise .9s ease-out forwards;pointer-events:none;z-index:2000}
@keyframes rise{0%{opacity:0;transform:translate(-50%,10px) scale(.9)}20%{opacity:1}100%{opacity:0;transform:translate(-50%,-40px) scale(1.05)}}

/* Banners (bottom) */
.banner{position:fixed;left:0;right:0;bottom:0;transform:translateY(100%);background:linear-gradient(135deg,#132647,#1d3a61);border-top:1px solid var(--pillBr);color:#fff;padding:12px 16px calc(12px + env(safe-area-inset-bottom));text-align:center;z-index:2500;animation:bannerIn .25s ease-out forwards, bannerOut .9s ease-in forwards 2.8s}
@keyframes bannerIn{to{transform:translateY(0)}}
@keyframes bannerOut{to{transform:translateY(10px);opacity:0}}

/* Toasts (top-right) */
.toasts{position:fixed;right:12px;top:12px;z-index:2600;display:flex;flex-direction:column;gap:8px}
.toast{background:#132647;border:1px solid #2a4a78;color:#fff;padding:10px 12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.35);animation:fadein .2s ease-out}
@keyframes fadein{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}

/* =========================
   MENU OVERLAY
   ========================= */
.menuOv{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);z-index:3000}
.menuOv.open{display:flex}
.panel{width:min(1024px,96vw);max-height:88vh;background:#0f1b2b;border:1px solid var(--border);border-radius:18px 18px 0 0;overflow:hidden;box-shadow:0 -12px 30px rgba(0,0,0,.45);display:flex;flex-direction:column}
.panelHead{display:flex;align-items:center;gap:10px;padding:10px var(--space);border-bottom:1px solid var(--border)}
.panelTitle{font-weight:900}
.hpMini{margin-left:auto;background:#132647;border:1px solid var(--pillBr);border-radius:999px;padding:4px 10px}
.menuTabs{display:flex;gap:8px;flex-wrap:wrap;padding:8px var(--space);border-bottom:1px solid var(--border)}
.tabBtn{padding:8px 12px;border-radius:999px;border:1px solid #2b3d5a;background:#13233b;color:#cfe0ff;font-weight:800;cursor:pointer}
.tabBtn.active{background:var(--accent);color:#fff;border-color:#e89d6b}
.panelBody{padding:14px var(--space);overflow:auto}
.grid{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
.coachCard,.upgradeCard{display:flex;gap:12px;align-items:center;background:#0c1525;border:1px solid #223556;border-radius:12px;padding:12px}
.coachCard.locked{opacity:.58;filter:grayscale(1)}
.headshot{width:64px;height:64px;border-radius:12px;overflow:hidden;border:1px solid #1a2f4a;background:#12243b;display:flex;align-items:center;justify-content:center}
.headshot img{width:100%;height:100%;object-fit:cover}
.cName{font-weight:900}
.cInfo{color:var(--muted);font-size:14px;margin-top:4px}
.hire{padding:10px 14px;border-radius:10px;border:0;font-weight:800;cursor:pointer;background:#1a2a40;color:#d7e3f5}
.hire.ready{background:var(--accent);color:#fff}
.hire.owned{background:#198754;color:#fff}
.upBtn{padding:10px 14px;border-radius:10px;border:0;font-weight:800;cursor:pointer;background:#1a2a40;color:#d7e3f5}
.upBtn.ready{background:var(--accent);color:#fff}

/* =========================
   START / SPLASH / TUTORIAL
   ========================= */
.splash{position:fixed;inset:0;background:#fff;z-index:5000;display:none;align-items:center;justify-content:center}
.splash.open{display:flex}
.splashInner{width:min(90vw,900px);height:min(80vh,600px);display:flex;align-items:center;justify-content:center;position:relative}
.splashLogo{max-width:100%;max-height:100%;animation:splashPop 1100ms cubic-bezier(.2,1.2,.3,1)}
@keyframes splashPop{0%{transform:scale(.82);opacity:0}45%{transform:scale(1.06);opacity:1}100%{transform:scale(1)}}

.start{position:fixed;inset:0;z-index:4500;display:none;align-items:center;justify-content:center;background:#000}
.start.open{display:flex}
.startFrame{position:relative;z-index:1;width:min(100vw,1100px);height:min(100vh,1200px);display:flex;align-items:center;justify-content:center;overflow:hidden}
.startArt{position:absolute;inset:0;background:#000}
.startArt img{width:100%;height:100%;object-fit:cover}
.startUI{position:absolute;left:50%;bottom:8vh;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:14px;width:min(92%,720px)}
.rowBtns{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;width:100%}
.btn{padding:14px 22px;border-radius:14px;border:0;font-weight:900;cursor:pointer}
.btn.orange{background:var(--accent);color:#fff}
.btn.blue{background:var(--brandBlue);color:#fff}
.segment{display:inline-flex;border:1px solid #2b3d5a;border-radius:12px;overflow:hidden;background:#13233b}
.segBtn{background:transparent;color:#cfe0ff;border:0;padding:10px 14px;font-weight:900;cursor:pointer;display:flex;align-items:center;gap:10px}
.segBtn.active{background:var(--accent);color:#fff}

/* Tutorial bubble (fixed width, no growth while typing) */
.tut{position:fixed;inset:0;z-index:4000;display:none}
.tut.show{display:block}
.dim{position:absolute;inset:0;background:rgba(0,0,0,.22)}
.bubble{position:absolute;left:56px;top:70px;max-width:min(560px,92vw);width:min(560px,92vw);background:#0f1b2b;border:2px solid var(--pillBr);border-radius:18px;padding:16px 18px;box-shadow:0 18px 36px rgba(0,0,0,.35)}
.tWho{font-weight:900;color:#ffd6a8;margin-bottom:6px}
.tText{min-height:64px;line-height:1.35}
.tNext{margin-top:10px;font-size:14px;color:#cfe0ff;display:flex;align-items:center;gap:10px}
.chev{color:var(--accent-hi);font-size:24px}
.spot{position:absolute;border-radius:16px;box-shadow:0 0 0 4px rgba(255,179,87,.95),0 0 0 14px rgba(255,179,87,.20),0 0 42px rgba(255,179,87,.45);pointer-events:none}

/* Offline modal */
.off{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);z-index:3500}
.off.open{display:flex}
.offCard{width:min(520px,94vw);background:#0f1b2b;border:1px solid var(--border);border-radius:16px;padding:18px;text-align:center}
.offTitle{margin:0 0 6px;font-weight:900}
.offAmt{font-weight:900;font-size:24px}

/* Accessibility */
@media (prefers-reduced-motion: reduce){
  .coolFill::after{animation:none}
  .banner{animation:none}
}
</style>
</head>
<body>

<!-- =========================
     TOP BAR
     ========================= -->
<div class="topbar">
  <div class="topwrap">
    <div class="leftRow">
      <button id="avatarBtn" class="avatarBtn" title="Menu">
        <img id="avatarImg" alt="Avatar" src="https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/NEW%20MALE%20AVATAR.gif?raw=true">
        <span id="menuDot" class="notifDot"></span>
      </button>
      <img class="logoImg" alt="Fitness Frenzy Logo" src="https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/FF-Logo%20(2).png?raw=true" />
    </div>
    <div class="qtyGroup" id="qtyGroup">
      <button class="qtyBtn active" data-q="1">Ã—1</button>
      <button class="qtyBtn" data-q="10">Ã—10</button>
      <button class="qtyBtn" data-q="100">Ã—100</button>
    </div>
    <div></div>
    <div class="hpRow">
      <div class="hpPill"><span class="hpLabel">HP:</span> <span id="hpTop" class="hpVal">0.00</span></div>
      <div id="buffBar" class="buffBar"></div>
    </div>
  </div>
</div>

<!-- =========================
     CONTENT
     ========================= -->
<div class="wrap">
  <div id="stack" class="stack"></div>
</div>

<div id="bannerHost"></div>
<div id="toasts" class="toasts"></div>

<!-- =========================
     MENU OVERLAY
     ========================= -->
<div id="menuOv" class="menuOv" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <div class="panelHead">
      <div class="panelTitle">Menu</div>
      <div class="hpMini">HP: <span id="hpMini">0.00</span></div>
      <button id="menuClose" class="btn" style="margin-left:auto;background:#1a2a40;color:#d7e3f5">Close</button>
    </div>
    <div class="menuTabs">
      <button class="tabBtn active" data-tab="coaches">Coaches</button>
      <button class="tabBtn" data-tab="achievements">Achievements</button>
      <button class="tabBtn" data-tab="upgrades">Upgrades</button>
      <button class="tabBtn" data-tab="quests">Side Quests</button>
      <button class="tabBtn" data-tab="stats">Stats</button>
      <button class="tabBtn" data-tab="settings">Settings</button>
    </div>
    <div class="panelBody">
      <div id="tab-coaches"></div>
      <div id="tab-achievements" style="display:none"></div>
      <div id="tab-upgrades" style="display:none"></div>
      <div id="tab-quests" style="display:none">
        <div class="coachCard"><div class="cInfo">Side Quests ideas (placeholder)</div></div>
      </div>
      <div id="tab-stats" style="display:none"></div>
      <div id="tab-settings" style="display:none"></div>
    </div>
  </div>
</div>

<!-- =========================
     TUTORIAL (bubble from avatar)
     ========================= -->
<div id="tut" class="tut" aria-hidden="true">
  <div class="dim"></div>
  <div id="spot" class="spot" style="display:none"></div>
  <div class="bubble" id="bubble">
    <div class="tWho" id="tWho">JAX</div>
    <div class="tText" id="tText">â€¦</div>
    <div class="tNext"><span>Next</span><span class="chev">â€º</span></div>
  </div>
</div>

<!-- =========================
     OFFLINE MODAL
     ========================= -->
<div id="off" class="off" aria-hidden="true">
  <div class="offCard">
    <h3 class="offTitle">Welcome back! ðŸ‘‹</h3>
    <div>You were away for <strong id="offDur">0s</strong>.</div>
    <div class="offAmt">You earned <strong id="offAmt">0.00</strong> HP while away.</div>
    <button id="offClaim" class="btn orange" style="margin-top:10px">Claim</button>
    <div id="offCapNote" style="color:#9fb1c8;margin-top:8px;display:none">Offline gains were capped for long absences.</div>
  </div>
</div>

<!-- =========================
     SPLASH / START
     ========================= -->
<div id="splash" class="splash" aria-hidden="false">
  <div class="splashInner">
    <img class="splashLogo" alt="GameBros" src="https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/GameBros%20Logo.png?raw=true">
  </div>
</div>

<div id="start" class="start" aria-hidden="true">
  <div class="startFrame">
    <div class="startArt">
      <picture>
        <source media="(max-width: 600px)" srcset="https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/FF-mobile.png?raw=true">
        <img alt="Cover" src="https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/FF-desktop.png?raw=true">
      </picture>
    </div>
    <div class="startUI">
      <div class="rowBtns" id="startButtonsRow">
        <button id="btnStart" class="btn orange">New Game</button>
        <button id="btnContinue" class="btn blue" style="display:none">Continue</button>
      </div>
      <div class="segment" id="avatarSeg">
        <button class="segBtn active" data-avatar="male" title="Male">
          <img alt="Male" src="https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/NEW%20MALE%20AVATAR.gif?raw=true" style="width:34px;height:34px;border-radius:8px;object-fit:cover">
          Male
        </button>
        <button class="segBtn" data-avatar="female" title="Female">
          <img alt="Female" src="https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/NEW%20FEMALE%20AVATAR.gif?raw=true" style="width:34px;height:34px;border-radius:8px;object-fit:cover">
          Female
        </button>
      </div>
    </div>
  </div>
</div>

<script>
/* ============================================================
   CONFIG / UTIL / BUS
   ============================================================ */
const App = {};
App.Config = Object.freeze({
  SAVE_KEY: 'ff-v1',
  SCHEMA: 1,
  DEC: 2,
  MIN_CD_MS: 100,
  NOTIFY_MS: 160,
  UI_MS: 80,
  SAVE_MS: 15000,
  OFFLINE_CAP_MS: 24*60*60*1000,
  PULSE_MIN_MS: 5000,
  PULSE_MAX_MS: 10000,
  SPLASH_MS: 5000,
  COFFEE:{ DURATION_MS: 10*60*1000, BASE_COST: 1500, GROWTH: 1.45 }
});

const $ = (q,root=document)=>root.querySelector(q);
const $$ = (q,root=document)=>Array.from(root.querySelectorAll(q));
const el = (tag,attrs={})=>{
  const n=document.createElement(tag);
  for(const k in attrs){
    if(k==='text')n.textContent=attrs[k];
    else if(k==='html')n.innerHTML=attrs[k];
    else n.setAttribute(k,attrs[k]);
  }
  return n;
};

const Bus = (()=>{ const m={}; return{
  on(e,f){(m[e]||(m[e]=[])).push(f)},
  emit(e,p){(m[e]||[]).slice().forEach(fn=>{try{fn(p)}catch{}})}
}})();

const Util = {
  clamp:(v,a,b)=>Math.max(a,Math.min(b,v)),
  fmtHP(n){
    const a=Math.abs(n), d=App.Config.DEC;
    if(a>=1e9)return (n/1e9).toFixed(d)+'B';
    if(a>=1e6)return (n/1e6).toFixed(d)+'M';
    if(a>=1e3)return (n/1e3).toFixed(d)+'K';
    return n.toFixed(d);
  },
  fmtCost(n){
    const d=App.Config.DEC;
    if(n<1e3) return n.toFixed(d);
    if(n<1e6) return (n/1e3).toFixed(d)+'K';
    if(n<1e9) return (n/1e6).toFixed(d)+'M';
    return (n/1e9).toFixed(d)+'B';
  },
  now: ()=>performance.now(),
  randInt:(a,b)=>Math.floor(a+Math.random()*(b-a+1)),
  inView: el=>{ if(!el) return false; const r=el.getBoundingClientRect(); return r.bottom>0 && r.right>0 && r.left<innerWidth && r.top<innerHeight; }
};

/* ============================================================
   AUDIO (music + sfx)
   ============================================================ */
const MusicURL = (matchMedia('(max-width: 600px)').matches)
  ? "https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/FF-fighting%20music%20(soft).mp3?raw=true"
  : "https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/FF-fighting%20music.mp3?raw=true";

const AudioSys = (()=> {
  let music, musicVol = matchMedia('(max-width: 600px)').matches ? 0.08 : 0.12, musicOn = false;
  const sfxEnabled = {on:true};

  const synth = (type='sine', f=660, d=0.12, g=0.08)=>{
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o=ctx.createOscillator(), q=ctx.createGain();
      o.type=type; o.frequency.value=f; q.gain.value=g;
      o.connect(q); q.connect(ctx.destination);
      o.start(); q.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + d); o.stop(ctx.currentTime + d + 0.02);
    }catch{}
  };

  function playSFX(hook){
    if(!sfxEnabled.on) return;
    if(hook==='tap.ok') synth('sine',700,0.07,0.07);
    else if(hook==='reps.buy') synth('square',420,0.12,0.08);
    else if(hook==='unlock.do') synth('triangle',300,0.2,0.1);
    else if(hook==='upgrade.apply') { synth('square',650,0.09,0.08); setTimeout(()=>synth('square',900,0.09,0.07),90); }
    else if(hook==='achievement.unlock') { synth('square',600,0.10,0.08); setTimeout(()=>synth('square',800,0.10,0.07),110); setTimeout(()=>synth('square',1000,0.12,0.07),220);}
    else if(hook==='ui.click') synth('sine',520,0.06,0.06);
    else if(hook==='ui.menu.open') synth('sine',480,0.06,0.06);
    else if(hook==='ui.menu.close') synth('sine',360,0.06,0.06);
    else if(hook==='ui.tab.switch') synth('sine',560,0.06,0.06);
    else if(hook==='tutorial.show' || hook==='tutorial.next'){ synth('triangle',520,0.10,0.07); }
    else if(hook==='boost.start'){ synth('square',780,0.10,0.10); setTimeout(()=>synth('square',980,0.08,0.08),100); }
    else if(hook==='boost.end'){ synth('triangle',320,0.20,0.10); }
  }

  function startMusic(){
    if(musicOn) return;
    musicOn=true;
    music = new Audio(MusicURL);
    music.loop=true; music.volume=musicVol;
    music.play().catch(()=>{ musicOn=false; });
  }

  function setMusicVol(v){ musicVol=v; if(music) music.volume=v; }

  return { play:playSFX, music:{start:startMusic,setVol:setMusicVol}, sfxEnabled };
})();

/* ============================================================
   STATE / SAVE / CONTENT
   ============================================================ */
const State = {
  hp:0, qty:1, avatar:'male',
  stats:{manual:0, auto:0, totalEarned:0},
  coaches:{}, achievements:{}, exercises:[],
  tutorial:{done:false, shown:{unlock:{}, coach:{}, upgrade:{}}},
  upgrades:null
};

function save(){ try{ localStorage.setItem(App.Config.SAVE_KEY, JSON.stringify({schema:App.Config.SCHEMA, ...State})); }catch{} }
function load(){
  try{ const raw = localStorage.getItem(App.Config.SAVE_KEY); if(!raw) return; const j=JSON.parse(raw); if(j.schema===App.Config.SCHEMA){ Object.assign(State,j); } }catch{}
}
load();

/* Upgrades init (additive, wonâ€™t break old saves) */
State.upgrades = State.upgrades || {
  consumables: { coffee: { owned: 0, activeUntil: 0 } },
  equipment:   { },
  meta:        { }
};

/* Avatars */
const Assets = {
  avatarMale:"https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/NEW%20MALE%20AVATAR.gif?raw=true",
  avatarFemale:"https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/NEW%20FEMALE%20AVATAR.gif?raw=true",
  trainer:"https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/fitness%20frenzy-%20coaches%20128%20x128%20test.gif?raw=true"
};

/* Exercise stills */
const EX_STILL_MALE = {
  walk:"https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/male%20walking.png?raw=true",
  jog:"https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/male%20running.png?raw=true",
  sit:"https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/male%20situps.png?raw=true",
  push:"https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/male%20pushups.png?raw=true",
};
const EX_STILL_FEMALE = {
  walk:"https://github.com/JOE-RUGGIA/fitness-frenzy/blob/main/female%20walking.png
