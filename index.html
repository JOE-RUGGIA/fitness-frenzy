<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fitness Frenzy — Core (no audio)</title>
  <style>
    :root{ --bg:#0f1020; --panel:#132042; --edge:#1e2b55; --text:#f2f6ff; --muted:#aab1d6; --good:#27c93f; --accent:#3aa6ff; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui}
    .wrap{max-width:920px;margin:0 auto;padding:14px}
    .top{position:sticky;top:0;background:linear-gradient(180deg,#151734,#10122a);border-bottom:1px solid #22254b;z-index:10}
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .bulk{display:inline-flex;background:#20244a;border:1px solid #2a2e5e;border-radius:10px;overflow:hidden}
    .bulk button{background:transparent;color:#fff;border:0;padding:8px 12px;cursor:pointer;min-width:52px}
    .bulk button.active{background:var(--accent);color:#061222;font-weight:800}
    .pills{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    .pill{background:#182047;border:1px solid #2a2e5e;padding:10px 12px;border-radius:12px;display:flex;justify-content:space-between}
    .cards{display:grid;gap:12px;margin-top:12px}
    .card{display:grid;grid-template-columns:120px 1fr;gap:14px;padding:12px;background:var(--panel);border:1px solid var(--edge);border-radius:14px}
    .tile{height:120px;border-radius:12px;background:#0e1634;border:1px solid var(--edge);position:relative;overflow:hidden;user-select:none;cursor:pointer}
    .tile.locked{filter:grayscale(100%);opacity:.9;cursor:default}
    .lvl{position:absolute;top:6px;left:6px;background:#0e1330;border:1px solid #2b2f63;border-radius:8px;padding:2px 7px;font-size:13px}
    .repband{position:absolute;left:6px;right:6px;bottom:6px;height:18px;border-radius:9px;background:#0e132e;border:1px solid #2a2e5e;overflow:hidden}
    .repfill{height:100%;width:0%;background:linear-gradient(90deg,#17b34c,#27c93f)}
    .reptext{position:absolute;inset:0;display:grid;place-items:center;font-size:13px;color:#cfead6}
    .title{font-weight:800;font-size:16px}
    .cool{margin-top:8px;height:22px;background:#141739;border:1px solid #2a2e5e;border-radius:8px;overflow:hidden;position:relative}
    .bar{position:absolute;inset:0;width:0%;background:
      repeating-linear-gradient(45deg,rgba(255,255,255,.18) 0, rgba(255,255,255,.18) 6px, rgba(255,255,255,0) 6px, rgba(255,255,255,0) 12px),
      linear-gradient(90deg,#2f6df3,#41b0ff)}
    .t{position:relative;z-index:1;padding-left:8px;color:#a6b0d8;font-size:14px}
    .meta{display:flex;align-items:center;justify-content:space-between;margin-top:10px;gap:10px;flex-wrap:wrap}
    .muted{color:var(--muted);font-size:15px}
    .btn{appearance:none;border:1px solid #2a2e5e;background:#1b1f44;color:#e9edff;padding:12px 16px;border-radius:12px;min-width:180px;cursor:pointer;font-size:15px}
    .btn.glow{box-shadow:0 0 0 2px rgba(58,166,255,.25) inset, 0 0 12px rgba(58,166,255,.35)}
    .btn-reps{font-weight:900}
    @media(max-width:480px){ .card{grid-template-columns:96px 1fr} .tile{height:96px} .btn{min-width:132px;padding:10px 12px;font-size:14px}}
  </style>
</head>
<body>
  <div class="top">
    <div class="wrap">
      <div class="row">
        <div style="display:flex;align-items:center;gap:12px">
          <strong>Fitness Frenzy</strong>
        </div>
        <div id="bulk" class="bulk">
          <button data-q="1" class="active">×1</button>
          <button data-q="10">×10</button>
          <button data-q="100">×100</button>
        </div>
      </div>
      <div class="pills">
        <div class="pill"><span>HP</span><span id="hp">0</span></div>
        <div class="pill"><span>Fitcoins</span><span id="fc">0</span></div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div id="cards" class="cards"></div>
  </div>

  <script>
  // ---------- Event bus (lets you add SFX later without touching core) ----------
  const Bus = new EventTarget();
  const emit = (type, detail={}) => Bus.dispatchEvent(new CustomEvent(type,{detail}));

  // ---------- Math / content ----------
  const Exercises = [
    {id:'walk',  name:'Walking',         baseCooldownMs:1000},
    {id:'jog',   name:'Jogging',         baseCooldownMs:3000},
    {id:'sit',   name:'Sit-ups',         baseCooldownMs:6000},
    {id:'push',  name:'Push-ups',        baseCooldownMs:12000},
    // add the rest later…
  ];
  const baseHP   = (idx,ms)=> idx===0 ? 1 : Math.round(20*Math.pow(ms/1000,1.10));
  const perTapHP = (b,rep)=> b+rep;
  const repBaseCost=b=>Math.max(4,Math.round(b*.05));
  const repGrowth = lvl=>Math.max(1.07,Math.min(1.15,1.07+0.01*Math.log2(Math.max(1,lvl))));
  const repCostSingle=(rb,g,rep)=> rb*Math.pow(g,rep);
  const repCostBulk  =(rb,g,rep,n)=> rb*Math.pow(g,rep)*((Math.pow(g,n)-1)/(g-1));
  const nextCooldown = ms=> Math.max(100, Math.floor(ms/2));
  const unlockCost   = (b,ms)=> Math.round(b*Math.pow(ms/1000,.60)*1.15);
  const coachPrice   = i=> i===0 ? 1500 : Math.round(1500*Math.pow(1.8,i)); // kept for later menus
  const fmt = n => {
    const a=Math.abs(n); if(a>=1e12) return (n/1e12).toFixed(2)+'T';
    if(a>=1e9) return (n/1e9).toFixed(2)+'B';
    if(a>=1e6) return (n/1e6).toFixed(2)+'M';
    if(a>=1e3) return (n/1e3).toFixed(2)+'K';
    return String(Math.floor(n||0));
  };

  // ---------- State ----------
  const KEY='ff-core-v1';
  const defaults = ()=>({
    hp:0, qty:1,
    exercises: Exercises.map((ex,i)=>({
      id:ex.id, unlocked:i===0, repHP:0, repTarget:10, level:1, cooldown:ex.baseCooldownMs, lastTapAt:0
    })),
    stats:{manual:0, auto:0, totalEarned:0}
  });
  function load(){
    try{ const raw=localStorage.getItem(KEY); if(raw){ const s=JSON.parse(raw); return migrate(s);} }catch{}
    return defaults();
  }
  function migrate(s){
    // keep it simple; ensure array alignment if list changes
    const byId=new Map((s.exercises||[]).map(e=>[e.id,e]));
    s.exercises = Exercises.map((ex,i)=>{
      const prev=byId.get(ex.id)||{};
      return {
        id:ex.id,
        unlocked: (i===0) || !!prev.unlocked,
        repHP: prev.repHP|0, repTarget: prev.repTarget||10,
        level: prev.level||1, cooldown: prev.cooldown||ex.baseCooldownMs,
        lastTapAt: 0
      };
    });
    s.qty = s.qty||1;
    s.hp  = s.hp|0;
    s.stats = s.stats||{manual:0,auto:0,totalEarned:0};
    return s;
  }
  let S = load();
  const save = ()=>{ try{ const copy=JSON.parse(JSON.stringify(S)); copy.exercises.forEach(e=>e.lastTapAt=0); localStorage.setItem(KEY, JSON.stringify(copy)); }catch{} };
  const patch = mut=>{ S = mut(JSON.parse(JSON.stringify(S))); save(); dirty=true; };

  // ---------- UI refs ----------
  const $ = (s,r=document)=>r.querySelector(s);
  const cardsRoot = $('#cards');
  const hpEl = $('#hp');
  const bulk = $('#bulk');

  // ---------- Cards ----------
  const cardRefs = new Map();
  function createCard(i){
    const meta=Exercises[i], ex=S.exercises[i];
    const card=document.createElement('div'); card.className='card';
    const tile=document.createElement('div'); tile.className='tile'; if(!ex.unlocked) tile.classList.add('locked');
    const lvl=document.createElement('div'); lvl.className='lvl'; lvl.textContent='Lvl '+ex.level;
    const repband=document.createElement('div'); repband.className='repband';
    const repfill=document.createElement('div'); repfill.className='repfill';
    const reptext=document.createElement('div'); reptext.className='reptext'; reptext.textContent=`${ex.repHP} / ${ex.repTarget}`;
    repband.append(repfill,reptext); tile.append(lvl,repband);

    const right=document.createElement('div');
    const title=document.createElement('div'); title.className='title'; title.textContent=meta.name;
    const cool=document.createElement('div'); cool.className='cool';
    const bar=document.createElement('div'); bar.className='bar';
    const t=document.createElement('div'); t.className='t'; t.textContent='Ready';
    cool.append(bar,t);
    const metaRow=document.createElement('div'); metaRow.className='meta';
    const left=document.createElement('div'); left.className='muted';
    const btn=document.createElement('button'); btn.className='btn'; metaRow.append(left,btn);
    right.append(title,cool,metaRow);
    card.append(tile,right);
    cardsRoot.append(card);

    // interactions
    tile.addEventListener('click', ()=>{
      const ex=S.exercises[i]; if(!ex || !ex.unlocked) return;
      const now=performance.now(); if(ex.lastTapAt>0 && now < ex.lastTapAt+ex.cooldown) return;
      const gain=perTapHP(baseHP(i,meta.baseCooldownMs), ex.repHP);
      patch(st=>{ st.hp+=gain; st.stats.manual++; st.stats.totalEarned+=gain; st.exercises[i].lastTapAt=now; return st; });
      emit('tile:tap',{index:i,gain});
    });

    btn.addEventListener('click', ()=>{
      const ex=S.exercises[i];
      if(!ex.unlocked){
        const price=unlockCost(baseHP(i,meta.baseCooldownMs), meta.baseCooldownMs);
        if(S.hp<price) return;
        patch(st=>{ st.hp-=price; st.exercises[i].unlocked=true; return st; });
        emit('exercise:unlock',{index:i,price});
        updateCard(meta.id); return;
      }
      const b=baseHP(i,meta.baseCooldownMs), rb=repBaseCost(b), g=repGrowth(ex.level);
      const qty=S.qty||1;
      const price=Math.ceil(qty===1?repCostSingle(rb,g,ex.repHP):repCostBulk(rb,g,ex.repHP,qty));
      if(S.hp<price) return;
      let leveled=false, beforeLvl=ex.level;
      patch(st=>{
        st.hp-=price; const e=st.exercises[i]; e.repHP += qty;
        while(e.repHP >= e.repTarget){ e.level++; e.cooldown=nextCooldown(e.cooldown); e.repTarget*=2; leveled=true; }
        return st;
      });
      emit('reps:purchase',{index:i,qty,price});
      if(leveled) emit('level:up',{index:i,from:beforeLvl,to:S.exercises[i].level});
      updateCard(meta.id);
    });

    cardRefs.set(meta.id,{idx:i,card,tile,lvl,repband,repfill,reptext,bar,t,left,btn,title});
    updateCard(meta.id);
  }

  function updateCard(id){
    const r=cardRefs.get(id); if(!r) return;
    const meta=Exercises[r.idx], ex=S.exercises[r.idx];
    r.lvl.textContent='Lvl '+ex.level;
    if(!ex.unlocked){
      r.tile.classList.add('locked');
      const price=unlockCost(baseHP(r.idx,meta.baseCooldownMs), meta.baseCooldownMs);
      r.left.textContent='—';
      r.btn.textContent='Unlock • '+fmt(price)+' HP'; r.btn.classList.remove('btn-reps');
      r.btn.classList.toggle('glow', S.hp>=price);
      r.reptext.textContent='—'; r.repfill.style.width='0%';
      return;
    }
    r.tile.classList.remove('locked');
    const b=baseHP(r.idx,meta.baseCooldownMs), hpTap=perTapHP(b,ex.repHP);
    r.left.textContent=hpTap+' HP / tap';
    const rb=repBaseCost(b), g=repGrowth(ex.level), qty=S.qty||1;
    const price=Math.ceil(qty===1?repCostSingle(rb,g,ex.repHP):repCostBulk(rb,g,ex.repHP,qty));
    r.btn.textContent='Reps • '+fmt(price)+' HP'; r.btn.classList.add('btn-reps');
    r.btn.classList.toggle('glow', S.hp>=price);
    r.reptext.textContent=`${ex.repHP} / ${ex.repTarget}`;
    r.repfill.style.width=Math.min(100, 100*ex.repHP/ex.repTarget)+'%';
  }

  function buildCards(){ cardsRoot.innerHTML=''; cardRefs.clear(); for(let i=0;i<Exercises.length;i++) createCard(i); }

  // ---------- Bulk selector ----------
  bulk.addEventListener('click', e=>{
    const b=e.target.closest('button'); if(!b) return;
    [...bulk.children].forEach(x=>x.classList.toggle('active', x===b));
    patch(st=>{ st.qty=parseInt(b.dataset.q,10)||1; return st; });
    emit('bulk:change',{qty:S.qty});
  });

  // ---------- Loop ----------
  let dirty=true;
  function frame(){
    if(dirty){ hpEl.textContent=fmt(S.hp); for(const id of cardRefs.keys()) updateCard(id); dirty=false; }
    const now=performance.now();
    for(let i=0;i<Exercises.length;i++){
      const ex=S.exercises[i]; const r=cardRefs.get(Exercises[i].id); if(!r) continue;
      if(!ex.unlocked){ r.bar.style.width='0%'; r.t.textContent='—'; continue; }
      if(!ex.lastTapAt){ r.bar.style.width='100%'; r.t.textContent='Ready'; }
      else{
        const dt=Math.max(0, now-ex.lastTapAt), remain=Math.max(0, ex.cooldown-dt);
        if(remain<=0){ r.bar.style.width='100%'; r.t.textContent='Ready'; }
        else{ r.bar.style.width=Math.min(100,100*dt/ex.cooldown)+'%'; r.t.textContent=(remain/1000).toFixed(2)+'s'; }
      }
    }
    requestAnimationFrame(frame);
  }

  // ---------- Boot ----------
  buildCards(); requestAnimationFrame(frame);

  // expose a tiny API for later plugins (SFX, etc.)
  window.FF = {
    get state(){ return S; },
    on:(type,fn)=>{ Bus.addEventListener(type,fn); return ()=>Bus.removeEventListener(type,fn); },
    emit
  };
  </script>










  <!-- ===== Coaches (no-audio) — styles ===== -->
<style data-ff-patch>
  /* bottom sheet */
  .ff-sheet{position:fixed; left:0; right:0; bottom:0; transform:translateY(102%); transition:transform .18s ease; z-index:50}
  .ff-sheet.show{transform:translateY(0)}
  .ff-sheet .shroud{position:fixed; inset:0; background:rgba(0,0,0,.55)}
  .ff-sheet .panel{position:relative; margin:12vh auto 0; max-width:820px; width:96vw;
    background:#101333; border:1px solid #2a2e5e; border-radius:16px 16px 0 0; padding:12px 12px 6px}
  .ff-sheet .top{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:6px 4px 10px; border-bottom:1px solid #24285a}
  .ff-sheet .title{font-weight:900; font-size:18px}
  .ff-sheet .close{appearance:none; border:1px solid #2a2e5e; background:#1b1f44; color:#e9edff; padding:8px 12px; border-radius:10px; cursor:pointer}
  .ff-coaches{max-height:56vh; overflow:auto; padding:12px 2px 10px}

  /* rows */
  .ff-row{display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center;
    background:#14163a; border:1px solid #2a2e5e; border-radius:12px; padding:10px 12px; margin:0 0 10px}
  .ff-ava{width:48px; height:48px; border-radius:50%; background:#2b2f63; display:grid; place-items:center; font-weight:800; overflow:hidden}
  .ff-ava img{width:100%; height:100%; object-fit:cover}
  .ff-title{font-weight:800}
  .ff-sub{font-size:13px; color:#a6adcf; margin-top:2px}
  .ff-hired{color:#27c93f; font-weight:900}
  .ff-btn{appearance:none; border:1px solid #2a2e5e; background:#1b1f44; color:#e9edff; padding:10px 14px; border-radius:12px; cursor:pointer; min-width:170px}
  .ff-btn.glow{box-shadow:0 0 0 2px rgba(255,192,120,.22) inset, 0 0 10px rgba(255,192,120,.28)}

  /* avatar dot (affordable) */
  #avatar .ff-dot{position:absolute; top:-6px; right:-6px; width:20px; height:20px; background:#27c93f; border-radius:50%; border:3px solid #0f1020; box-shadow:0 4px 10px rgba(0,0,0,.35); display:none}
  #avatar.has-affordable .ff-dot{display:block}
</style>









  <!-- ===== Coaches (no-audio) — logic ===== -->
<script type="application/ff-patch">
(function(){
  if (window.__FF_COACHES_V1__) return;
  window.__FF_COACHES_V1__ = true;

  /* ---------- tiny core-API shim (works with your existing save) ---------- */
  const KEY='ff-v1';
  function ensure(d){
    d = d||{};
    d.hp = d.hp|0;
    d.coaches = d.coaches||{};
    d.exercises = Array.isArray(d.exercises)? d.exercises : [];
    d.stats = d.stats||{manual:0,auto:0,totalEarned:0,totalPlayMs:0};
    d.schema = d.schema|0;
    return d;
  }
  function load(){ try{ return ensure(JSON.parse(localStorage.getItem(KEY)||'{}')); }catch(_){ return ensure({}); } }
  function save(s){ try{ localStorage.setItem(KEY, JSON.stringify(s)); }catch(_){ } }
  function patch(mut){ const s=load(); const out=ensure(mut(s)); save(out); return out; }
  function get(){ return load(); }

  /* ---------- the same math you’ve been using ---------- */
  const Exercises = window.Exercises || []; // if your core exposes it
  const coachPrice = i => (i===0?1500:Math.round(1500*Math.pow(1.8,i)));
  const baseHP = (idx,ms)=> idx===0?1:Math.round(20*Math.pow(ms/1000,1.10));
  const perTapHP = (b,rep)=> b + (rep|0);

  /* ---------- build bottom sheet ---------- */
  const avatar = document.getElementById('avatar');
  if (avatar && !avatar.querySelector('.ff-dot')){
    const dot=document.createElement('i'); dot.className='ff-dot'; avatar.appendChild(dot);
  }

  const sheet = document.createElement('div');
  sheet.className = 'ff-sheet';
  sheet.innerHTML = `
    <div class="shroud" data-close></div>
    <div class="panel" role="dialog" aria-modal="true" aria-label="Coaches">
      <div class="top">
        <div class="title">Coaches</div>
        <button class="close" data-close>Close</button>
      </div>
      <div class="ff-coaches" id="ff-coaches-body"></div>
    </div>`;
  document.body.appendChild(sheet);
  const body = sheet.querySelector('#ff-coaches-body');

  function open(){ sheet.classList.add('show'); document.documentElement.style.overflow='hidden'; emit('menu:open',{tab:'coaches'}); }
  function close(){ sheet.classList.remove('show'); document.documentElement.style.overflow=''; emit('menu:close',{tab:'coaches'}); }
  sheet.addEventListener('click', e=>{ if(e.target.closest('[data-close]')) close(); });

  if (avatar){
    avatar.addEventListener('click', ()=> open());
  }

  /* ---------- rendering ---------- */
  const fmt=n=>{ const a=Math.abs(n); if(a>=1e9) return (n/1e9).toFixed(2)+'B'; if(a>=1e6) return (n/1e6).toFixed(2)+'M'; if(a>=1e3) return (n/1e3).toFixed(2)+'K'; return String(Math.floor(n)); };

  function rowFor(i, s){
    const ex = s.exercises[i]; if(!ex || !ex.unlocked) return null;
    const hired = !!s.coaches['c'+(i+1)];
    const price = coachPrice(i);

    const div=document.createElement('div');
    div.className='ff-row';
    div.innerHTML = `
      <div class="ff-ava">${/* you can drop an image here later */''}</div>
      <div>
        <div class="ff-title">Coach ${i+1}</div>
        <div class="ff-sub">Works on: ${Exercises[i]?.name || ('Exercise '+(i+1))}</div>
      </div>
      <div class="ff-act"></div>
    `;
    const act = div.querySelector('.ff-act');
    if (hired){
      const tag=document.createElement('span'); tag.className='ff-hired'; tag.textContent='Hired'; act.appendChild(tag);
    }else{
      const btn=document.createElement('button'); btn.className='ff-btn'; btn.textContent='Hire • '+fmt(price)+' HP';
      if (s.hp>=price) btn.classList.add('glow');
      btn.addEventListener('click', ()=>{
        const cur=get(); const priceNow=coachPrice(i); // recalc
        if(cur.hp < priceNow || cur.coaches['c'+(i+1)]) return;
        patch(st=>{ st.hp -= priceNow; st.coaches['c'+(i+1)] = true; return st; });
        emit('coach:hired', {index:i});
        render(); // refresh UI
        // also flip an affordable-dot refresh
        updateAffordableDot();
      });
      act.appendChild(btn);
    }
    return div;
  }

  function render(){
    const s=get();
    body.innerHTML='';
    let any=false;
    for(let i=0;i<Exercises.length;i++){
      const ex=s.exercises[i]; if(!ex || !ex.unlocked) continue;
      const row=rowFor(i,s); if(row){ any=true; body.appendChild(row); }
    }
    if(!any){
      body.innerHTML = `<div class="ff-sub">Unlock an exercise to hire its coach.</div>`;
    }
    updateAffordableDot();
  }

  function updateAffordableDot(){
    const s=get();
    let affordable=false;
    for(let i=0;i<Exercises.length;i++){
      const ex=s.exercises[i]; if(!ex || !ex.unlocked) continue;
      const id='c'+(i+1);
      if(s.coaches[id]) continue;
      const price=coachPrice(i);
      if(s.hp>=price){ affordable=true; break; }
    }
    if(avatar){
      avatar.classList.toggle('has-affordable', affordable);
    }
  }

  /* ---------- auto-tap engine for hired coaches (no audio) ---------- */
  function autoTick(){
    const s=get();
    const now = performance.now();
    let changed = false;

    for(let i=0;i<Exercises.length;i++){
      const ex = s.exercises[i]; if(!ex || !ex.unlocked) continue;
      const hired = !!s.coaches['c'+(i+1)];
      if(!hired) continue;

      const cd = ex.cooldown|0;
      const last = ex.lastTapAt|0;
      if(last===0 || now >= last + cd){
        const base = baseHP(i, (window.Exercises?.[i]?.baseCooldownMs) || cd);
        const gain = perTapHP(base, ex.repHP|0);
        ex.lastTapAt = now;
        s.hp += gain;
        s.stats.totalEarned = (s.stats.totalEarned|0) + gain;
        s.stats.auto = (s.stats.auto|0) + 1;
        changed = true;
      }
    }
    if(changed) save(s);
    requestAnimationFrame(autoTick);
  }

  /* ---------- event bus (for future audio, analytics, etc.) ---------- */
  function emit(type, detail){ 
    try{ document.dispatchEvent(new CustomEvent('ff:'+type, {detail})); }catch(_){}
    if (window.ffHooks && typeof window.ffHooks.emit === 'function'){ 
      try{ window.ffHooks.emit(type, detail); }catch(_){}
    }
  }

  /* ---------- react to HP changes from core so glow/dot stay fresh ---------- */
  (function observeHp(){
    const hpEl = document.getElementById('hp-readout');
    if(!hpEl) return;
    let last = hpEl.textContent;
    new MutationObserver(()=>{ const cur=hpEl.textContent; if(cur!==last){ last=cur; render(); } })
      .observe(hpEl, {childList:true, characterData:true, subtree:true});
  })();

  /* ---------- boot ---------- */
  render();
  requestAnimationFrame(autoTick);

})();
</script>






  <script type="application/ff-patch">
(function(){
  if (window.__FF_TEST_HARNESS__) return;
  window.__FF_TEST_HARNESS__ = true;

  /* --- minimal save helpers (isolated from core) --- */
  const KEY='ff-v1';
  function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'{}'); }catch(_){ return {}; } }
  function save(s){ try{ localStorage.setItem(KEY, JSON.stringify(s)); }catch(_){} }

  /* --- public test API --- */
  window.ffTest = {
    addHP(n=100000){
      const s=load(); s.hp=(s.hp|0)+n; save(s);
      // if your core mirrors hp to #hp-readout, nudge UI by re-setting text
      const el=document.getElementById('hp-readout');
      if(el){ el.textContent = el.textContent; } // triggers observers without changing number formatting
      console.log('[ffTest] +HP', n);
    },
    unlock(n=2){
      const s=load(); s.exercises = Array.isArray(s.exercises)? s.exercises : [];
      for(let i=0;i<=n;i++){ if(s.exercises[i]) s.exercises[i].unlocked = true; }
      save(s);
      console.log('[ffTest] unlocked first', n+1, 'exercises — reload if UI doesn’t auto-refresh');
    },
    open(){
      const sh=document.querySelector('.ff-sheet'); if(sh){ sh.classList.add('show'); document.documentElement.style.overflow='hidden'; }
    },
    close(){
      const sh=document.querySelector('.ff-sheet'); if(sh){ sh.classList.remove('show'); document.documentElement.style.overflow=''; }
    }
  };

  /* --- temporary button if #avatar doesn’t exist --- */
  if (!document.getElementById('avatar')){
    const btn=document.createElement('button');
    btn.id='ff-dev-coaches';
    btn.textContent='Coaches';
    btn.style.cssText='position:fixed;right:14px;bottom:14px;z-index:60;padding:10px 12px;border-radius:12px;border:1px solid #2a2e5e;background:#1b1f44;color:#e9edff;cursor:pointer';
    btn.addEventListener('click', ()=>{
      const sh=document.querySelector('.ff-sheet');
      if(sh){ sh.classList.add('show'); document.documentElement.style.overflow='hidden'; }
    });
    document.body.appendChild(btn);
  }

  /* --- keyboard: Shift + C toggles the sheet --- */
  document.addEventListener('keydown', (e)=>{
    if ((e.key||'').toLowerCase()==='c' && e.shiftKey){
      const sh=document.querySelector('.ff-sheet'); if(!sh) return;
      const show = !sh.classList.contains('show');
      sh.classList.toggle('show', show);
      document.documentElement.style.overflow = show ? 'hidden' : '';
    }
  }, {capture:true});

})();
</script>

                

  <!-- (Optional) Later: add a separate sfx.js that only listens to events, e.g.
  <script src="sfx.js"></script>
  -->
</body>
</html>
